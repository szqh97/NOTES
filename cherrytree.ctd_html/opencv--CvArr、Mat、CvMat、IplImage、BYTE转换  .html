<!doctype html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><title>CvArr、Mat、CvMat、IplImage、BYTE转换  </title><meta name="generator" content="CherryTree"></head><body><table width="100%"><tr><td valign="top" align=cons.TAG_PROP_LEFT width=20%><table style="text-align:left; font-family: Sans; font-size:11pt"><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="C++.html">1 C++</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--tips.html">1.1 tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--FAQ.html">1.2 FAQ</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--todo.html">1.3 todo</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--others.html">1.4 others</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--vobile 常用.html">1.5 vobile 常用</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--snippet.html">1.6 snippet</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_black.png" alt="images/cherry_black.png" height="22" width="22"/><a href="C++--Modern C++ .html">1.7 Modern C++ </a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_black.png" alt="images/cherry_black.png" height="22" width="22"/><a href="C++--bak.html">1.8 bak</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="go.html">2 go</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="go--nsq-notes.html">2.1 nsq-notes</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="go--go_tips.html">2.2 go_tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Q&A.html">3 Q&A</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="kernel.html">4 kernel</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="ffmpeg.html">5 ffmpeg</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="ffmpeg--ffmpeg SDK.html">5.1 ffmpeg SDK</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="ffmpeg--ffmpeg.html">5.2 ffmpeg</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="python.html">6 python</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="python--tips.html">6.1 tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_green.png" alt="images/cherry_green.png" height="22" width="22"/><a href="python--collections.html">6.2 collections</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="python--oneline.html">6.3 oneline</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Lua.html">7 Lua</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Lua--tips.html">7.1 tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Linux.html">8 Linux</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--shell.html">8.1 shell</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--collections.html">8.2 collections</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--screen.html">8.3 screen</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--core文件设置.html">8.4 core文件设置</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--Linux 常用.html">8.5 Linux 常用</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_orange.png" alt="images/cherry_orange.png" height="22" width="22"/><a href="Linux--Linux 常用--screen.html">8.5.1 screen</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_orange.png" alt="images/cherry_orange.png" height="22" width="22"/><a href="Linux--Linux 常用--core文件设置.html">8.5.2 core文件设置</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_purple.png" alt="images/cherry_purple.png" height="22" width="22"/><a href="Linux--sed.html">8.6 sed</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="gdb.html">9 gdb</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="tools.html">10 tools</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="vim.html">11 vim</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="vim--vim常用 .html">11.1 vim常用 </a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="vobile.html">12 vobile</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="vobile--vobile 常用.html">12.1 vobile 常用</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="vobile--work.html">12.2 work</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Myself.html">13 Myself</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--TOREAD.html">13.1 TOREAD</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--music.html">13.2 music</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--todo.html">13.3 todo</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--work.html">13.4 work</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--HZ.html">13.5 HZ</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="opencv.html">14 opencv</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="opencv--CvArr、Mat、CvMat、IplImage、BYTE转换  .html">14.1 CvArr、Mat、CvMat、IplImage、BYTE转换  </a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="opencv--resize.html">14.2 resize</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="work.html">15 work</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="work--TODO.html">15.1 TODO</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="work--OCR.html">15.2 OCR</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="work--todo.html">15.3 todo</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_gray.png" alt="images/cherry_gray.png" height="22" width="22"/><a href="work--sql.html">15.4 sql</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="CNTV.html">16 CNTV</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Mysql.html">17 Mysql</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="git.html">18 git</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="others.html">19 others</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_purple.png" alt="images/cherry_purple.png" height="22" width="22"/><a href="gnuplot.html">20 gnuplot</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="todo.html">21 todo</a></td></tr></table><td valign="top" align=cons.TAG_PROP_LEFT width=80%><span style="font-family: 文泉驿微米黑; font-size:12pt">一、Mat类型：矩阵类型，Matrix。<br>    在openCV中，Mat是一个多维的密集数据数组。可以用来处理向量和矩阵、图像、直方图等等常见的多维数据。<br>    Mat有3个重要的方法：<br>         1、Mat mat = imread(const String* filename);            读取图像<br>         2、imshow(const string frameName, InputArray mat);      显示图像<br>         3、imwrite (const string&amp; filename, InputArray img);    储存图像<br>    Mat类型较CvMat与IplImage类型来说，有更强的矩阵运算能力，支持常见的矩阵运算。在计算密集型的应用当中，将CvMat与IplImage类型转化为Mat类型将大大减少计算时间花费。<br>A.Mat -&gt; IplImage<br>同样只是创建图像头，而没有复制数据。<br>例： // 假设Mat类型的imgMat图像数据存在<br>IplImage pImg= IplImage(imgMat); <br>B.Mat -&gt; CvMat<br>与IplImage的转换类似，不复制数据，只创建矩阵头。<br>例： // 假设Mat类型的imgMat图像数据存在<br>     CvMat cvMat = imgMat;<br> <br>二、CvMat类型与IplImage类型：“图像”类型<br>       在 openCV中，Mat类型与CvMat和IplImage类型都可以代表和显示图像，但是，Mat类型侧重于计算，数学性较高，openCV对Mat类 型的计算也进行了优化。而CvMat和IplImage类型更侧重于“图像”，openCV对其中的图像操作（缩放、单通道提取、图像阈值操作等）进行了 优化。<br>补充：IplImage由CvMat派生，而CvMat由CvArr派生即CvArr -&gt; CvMat -&gt; IplImage<br>            CvArr用作函数的参数，无论传入的是CvMat或IplImage，内部都是按CvMat处理。<br>1.CvMat<br>A.CvMat-&gt; IplImage<br>IplImage* img = cvCreateImage(cvGetSize(mat),8,1);<br>cvGetImage(matI,img);<br>cvSaveImage("rice1.bmp",img);<br>B.CvMat-&gt;Mat<br>与IplImage的转换类似，可以选择是否复制数据。<br>Mat::Mat(const CvMat* m, bool copyData=false);<br>在openCV中，没有向量（vector）的数据结构。任何时候，但我们要表示向量时，用矩阵数据表示即可。<br>但是，CvMat类型与我们在线性代数课程上学的向量概念相比，更抽象，比如CvMat的元素数据类型并不仅限于基础数据类型，比如，下面创建一个二维数据矩阵：<br>              CvMat* cvCreatMat(int rows ,int cols , int type);<br>这里的type可以是任意的预定义数据类型，比如RGB或者别的多通道数据。这样我们便可以在一个CvMat矩阵上表示丰富多彩的图像了。<br> <br>2.IplImage<br>在类型关系上，我们可以说IplImage类型继承自CvMat类型，当然还包括其他的变量将之解析成图像数据。<br>IplImage 类型较之CvMat多了很多参数，比如depth和nChannels。在普通的矩阵类型当中，通常深度和通道数被同时表示，如用32位表示 RGB+Alpha.但是，在图像处理中，我们往往将深度与通道数分开处理，这样做是OpenCV对图像表示的一种优化方案。<br>IplImage 的对图像的另一种优化是变量origin----原点。在计算机视觉处理上，一个重要的不便是对原点的定义不清楚，图像来源，编码格式，甚至操作系统都会 对原地的选取产生影响。为了弥补这一点，openCV允许用户定义自己的原点设置。取值0表示原点位于图片左上角，1表示左下角。<br>dataOrder参数定义数据的格式。有IPL_DATA_ORDER_PIXEL和IPL_DATA_ORDER_PLANE两种取值，前者便是对于像素，不同的通道的数据交叉排列，后者表示所有通道按顺序平行排列。<br>IplImage类型的所有额外变量都是对“图像”的表示与计算能力的优化。<br>A.IplImage -&gt; Mat<br>IplImage* pImg = cvLoadImage("lena.jpg");<br>Mat img(pImg,0); // 0是不複製影像，也就是pImg與img的data共用同個記憶體位置，header各自有<br>B.IplImage -&gt; CvMat<br>法1：CvMat mathdr, *mat = cvGetMat( img, &amp;mathdr );<br>法2：CvMat *mat = cvCreateMat( img-&gt;height, img-&gt;width, CV_64FC3 );<br>  cvConvert( img, mat );<br>C.IplImage*-&gt; BYTE*<br>BYTE* data= img-&gt;imageData;<br> <br>CvMat和IplImage创建时的一个小区别：<br>1、建立矩阵时，第一个参数为行数，第二个参数为列数。<br>CvMat* cvCreateMat( int rows, int cols, int type );<br>2、建立图像时，CvSize第一个参数为宽度，即列数；第二个参数为高度，即行数。这 个和CvMat矩阵正好相反。<br>IplImage* cvCreateImage(CvSize size, int depth, int channels );<br>CvSize cvSize( int width, int height );<br> <br>IplImage内部buffer每行是按4字节对齐的，CvMat没有这个限制<br> <br>补充：<br>A.BYTE*-&gt; IplImage*<br>img= cvCreateImageHeader(cvSize(width,height),depth,channels);<br>cvSetData(img,data,step);<br>//首先由cvCreateImageHeader()创建IplImage图像头，制定图像的尺寸，深度和通道数；<br>//然后由cvSetData()根据BYTE*图像数据指针设置IplImage图像头的数据数据，<br>//其中step指定该IplImage图像每行占的字节数，对于1通道的IPL_DEPTH_8U图像，step可以等于width。<br></span></td></tr></table></body></html>