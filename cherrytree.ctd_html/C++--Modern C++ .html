<!doctype html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><title>Modern C++ </title><meta name="generator" content="CherryTree"></head><body><table width="100%"><tr><td valign="top" align=cons.TAG_PROP_LEFT width=20%><table style="text-align:left; font-family: Sans; font-size:11pt"><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="C++.html">1 C++</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--tips.html">1.1 tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--FAQ.html">1.2 FAQ</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--todo.html">1.3 todo</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--others.html">1.4 others</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--vobile 常用.html">1.5 vobile 常用</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--snippet.html">1.6 snippet</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_black.png" alt="images/cherry_black.png" height="22" width="22"/><a href="C++--Modern C++ .html">1.7 Modern C++ </a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_black.png" alt="images/cherry_black.png" height="22" width="22"/><a href="C++--bak.html">1.8 bak</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="go.html">2 go</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="go--nsq-notes.html">2.1 nsq-notes</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="go--go_tips.html">2.2 go_tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Q&A.html">3 Q&A</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="kernel.html">4 kernel</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="ffmpeg.html">5 ffmpeg</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="ffmpeg--ffmpeg SDK.html">5.1 ffmpeg SDK</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="ffmpeg--ffmpeg.html">5.2 ffmpeg</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="python.html">6 python</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="python--tips.html">6.1 tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_green.png" alt="images/cherry_green.png" height="22" width="22"/><a href="python--collections.html">6.2 collections</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="python--oneline.html">6.3 oneline</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Lua.html">7 Lua</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Lua--tips.html">7.1 tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Linux.html">8 Linux</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--shell.html">8.1 shell</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--collections.html">8.2 collections</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--screen.html">8.3 screen</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--core文件设置.html">8.4 core文件设置</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--Linux 常用.html">8.5 Linux 常用</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_orange.png" alt="images/cherry_orange.png" height="22" width="22"/><a href="Linux--Linux 常用--screen.html">8.5.1 screen</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_orange.png" alt="images/cherry_orange.png" height="22" width="22"/><a href="Linux--Linux 常用--core文件设置.html">8.5.2 core文件设置</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_purple.png" alt="images/cherry_purple.png" height="22" width="22"/><a href="Linux--sed.html">8.6 sed</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="gdb.html">9 gdb</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="tools.html">10 tools</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="vim.html">11 vim</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="vim--vim常用 .html">11.1 vim常用 </a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="vobile.html">12 vobile</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="vobile--vobile 常用.html">12.1 vobile 常用</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="vobile--work.html">12.2 work</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Myself.html">13 Myself</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--TOREAD.html">13.1 TOREAD</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--music.html">13.2 music</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--todo.html">13.3 todo</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--work.html">13.4 work</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--HZ.html">13.5 HZ</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="opencv.html">14 opencv</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="opencv--CvArr、Mat、CvMat、IplImage、BYTE转换  .html">14.1 CvArr、Mat、CvMat、IplImage、BYTE转换  </a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="opencv--resize.html">14.2 resize</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="work.html">15 work</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="work--TODO.html">15.1 TODO</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="work--OCR.html">15.2 OCR</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="work--todo.html">15.3 todo</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_gray.png" alt="images/cherry_gray.png" height="22" width="22"/><a href="work--sql.html">15.4 sql</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="CNTV.html">16 CNTV</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Mysql.html">17 Mysql</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="git.html">18 git</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="others.html">19 others</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_purple.png" alt="images/cherry_purple.png" height="22" width="22"/><a href="gnuplot.html">20 gnuplot</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="todo.html">21 todo</a></td></tr></table><td valign="top" align=cons.TAG_PROP_LEFT width=80%><span style="font-family: Monospace; font-size:12pt"><span style="color:#0088ff;font-weight:400">//////////////////////////////////////////////////</span><br>&nbsp;&nbsp;&nbsp;&nbsp;基于Policy的Class设计&nbsp;（Policy-Based&nbsp;Class&nbsp;Design）<br><br>Q1.&nbsp;什么是Policy，&nbsp;policy&nbsp;与纯虚函数有什么异同&nbsp;什么是符合&nbsp;policy&nbsp;的一个类？P9<br>Q2.&nbsp;何为&nbsp;<span style="color:#ff9d00;font-weight:700">template</span>&nbsp;<span style="color:#ff9d00;font-weight:700">template</span>&nbsp;参数？<br>&nbsp;&nbsp;&nbsp;&nbsp;host&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;：如果class使用一个或者多个policies&nbsp;称其为host&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>，&nbsp;它负责把policy<br>&nbsp;&nbsp;&nbsp;&nbsp;的结构和行为组合为一个更复杂的结构和行为。每一个参数代表一个policy<br><span style="color:#0088ff;font-weight:400">//&nbsp;Library&nbsp;code</span><br><span style="color:#ff9d00;font-weight:700">template</span>&nbsp;&lt;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;CreationPolicy&gt;<br><span style="color:#ff9d00;font-weight:700">class</span>&nbsp;widgetManager:&nbsp;<span style="color:#ff9d00;font-weight:700">public</span>&nbsp;CreationPolicy<br>{&nbsp;...&nbsp;};<br><br><span style="color:#0088ff;font-weight:400">//Aplication&nbsp;code</span><br><span style="color:#ff9d00;font-weight:700">typedef</span>&nbsp;WidgetCreator&lt;&nbsp;OpNewCreator&lt;Widget&gt;&nbsp;&gt;&nbsp;myWidgetMgr;<br><br>一般来说，host&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;已经知道policy&nbsp;class所需的参数，&nbsp;或是轻易可推导出来。<br><span style="color:#0088ff;font-weight:400">//&nbsp;Library&nbsp;code</span><br><span style="color:#ff9d00;font-weight:700">template</span>&nbsp;&lt;<span style="color:#ff9d00;font-weight:700">template</span>&nbsp;&lt;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;Created&gt;&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;CreationPolicy&nbsp;=&nbsp;OpNewCreator&gt;<br><span style="color:#ff9d00;font-weight:700">class</span>&nbsp;widgeManager&nbsp;:&nbsp;<span style="color:#ff9d00;font-weight:700">public</span>&nbsp;CreationPolicy&lt;Widge&gt;<br>{&nbsp;...&nbsp;};<br><br><span style="color:#0088ff;font-weight:400">//&nbsp;Aplication&nbsp;code</span><br><span style="color:#ff9d00;font-weight:700">typedef</span>&nbsp;WidgetManager&lt;OpNewCreator&gt;&nbsp;MyWidgetMgr;<br><br>Policy&nbsp;不适用于动态连结和二进位接口（何为二进位接口？），所以本质上Policies和传统的接口并不互相竞争<br><br>关于析构的问题：可以将一个host&nbsp;class自动转换为一个Policy&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>(向上转型）<br>并稍后delete&nbsp;该指针，否则直接delete该指针会出现不可预知的行为;在Policy中定义虚析构函数，<br>&nbsp;&nbsp;&nbsp;&nbsp;会妨碍Policy的静态连结特性，会为对象大小带来额外的开销。Policy只规范行为，<br>&nbsp;&nbsp;&nbsp;&nbsp;要避免虚析构函数<br><br>Q：&nbsp;虚函数是不是在执行速度上有额外的开销？<br><br>将class&nbsp;分解为polices时的准则：<br><span style="color:#ff0044;font-weight:400">1.</span>&nbsp;把你的class内的”设计决定”局部化、命令，分离出来。<br><span style="color:#ff0044;font-weight:400">2.</span>&nbsp;找出正交的policies--也就是彼此之间没有交互作用、可独立更动的polices<br>Q:&nbsp;在设计一个类时，如何拆分出正交的Policies？<br>如果必须使用和非正交的Policies，尽可能借着&nbsp;”&nbsp;把policy&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;当做引用参数传给其他policy&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;<span style="color:#ff9d00;font-weight:700">template</span>&nbsp;function&nbsp;“&nbsp;来降低相依性，这样policy就必须暴露一些实现细节给其他&nbsp;的Policy&nbsp;会降低封装性<br>Policy机制由template&nbsp;和多重继承组成&nbsp;&nbsp;&nbsp;<br>Policy-to-Policy&nbsp;的拷贝方式<br><br><span style="color:#0088ff;font-weight:400">/////////////////////////////////////////////</span><br>不存在template函数的特化.<br><br>偏特化机制不能用在函数上，不论成员函数还是非成员函数。<br><span style="color:#ff0044;font-weight:400">1.</span>&nbsp;可以全特化&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;<span style="color:#ff9d00;font-weight:700">template</span>&nbsp;中的成员函数，但是不能偏特化它们<br><span style="color:#ff0044;font-weight:400">2.</span>&nbsp;不能偏特化namespace-level&nbsp;函数，（函数重载）&nbsp;<br><br><span style="color:#0088ff;font-weight:400">/////////////////////////////////////////////</span><br>local&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;不能定义static成员变量，也不能访问non-static局部变量。可以在template&nbsp;函数中使用。定义template&nbsp;函数内的local&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;可以使用函数的template参数<br>任何运用template&nbsp;class的手法，都可以改用<span style="color:#3ad900;font-weight:400">"函数外的template&nbsp;class"</span>来完成。<br>local&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;类似于Java中的final，&nbsp;外界不能继承一个隐藏于函数内的local&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>。如果没有local&nbsp;<span style="color:#ff9d00;font-weight:700">class</span>&nbsp;要实现java中的final，需要在编译元中加上一个无具名的命名空间。<br><span style="color:#0088ff;font-weight:400">//////////////////////////////////////////</span><br>&nbsp;&nbsp;&nbsp;Mapping&nbsp;Integral&nbsp;Constants&nbsp;to&nbsp;types<br>&nbsp;&nbsp;&nbsp;适用Int2Type的两个条件：<br>&nbsp;&nbsp;&nbsp;<span style="color:#ff0044;font-weight:400">1.</span>&nbsp;有必要根据某个编译期常数调用一个或数个不同的函数<br>&nbsp;&nbsp;&nbsp;<span style="color:#ff0044;font-weight:400">2.</span>&nbsp;有必要在编译期实施<span style="color:#3ad900;font-weight:400">"分派"</span><br>&nbsp;&nbsp;&nbsp;如果在执行是进行分派，只要使用if-<span style="color:#ff9d00;font-weight:700">else</span>&nbsp;<span style="color:#ff9d00;font-weight:700">or</span>&nbsp;<span style="color:#ff9d00;font-weight:700">switch</span>&nbsp;就好了<br>&nbsp;&nbsp;&nbsp;<span style="color:#0088ff;font-weight:400">//////////////////////////</span><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;编译期间的侦测可转换性和继承性<br>可以把sizeof用在任何表达式，不论后者有多复杂，sizeof会直接传回大小，不会等到执行时。这意味着sizeof可以感知重载，模板实例化，转换规则，或任何发生在C++表达式上的机制<br><span style="color:#0088ff;font-weight:400">//////////////////////</span><br>C++不允许reference&nbsp;to&nbsp;reference<br>虚函数没有template&nbsp;版本<br>在编译时不能使用迭代，只能用递归，原因：<br>Template&nbsp;更明确的是template&nbsp;specialization&nbsp;,提供编译期间的if叙述<br>在编译期间数值是不可变的，一旦定义了一个整数常数，就不能再改变它<br>在编译期间没有一个可变化的东西，在编译期间没法使用迭代，只可以使用递归</span></td></tr></table></body></html>