<!doctype html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><title>ffmpeg</title><meta name="generator" content="CherryTree"></head><body><table width="100%"><tr><td valign="top" align=cons.TAG_PROP_LEFT width=20%><table style="text-align:left; font-family: Sans; font-size:11pt"><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="C++.html">1 C++</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--tips.html">1.1 tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--FAQ.html">1.2 FAQ</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--todo.html">1.3 todo</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--others.html">1.4 others</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--work 常用.html">1.5 work 常用</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="C++--snippet.html">1.6 snippet</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_black.png" alt="images/cherry_black.png" height="22" width="22"/><a href="C++--Modern C++ .html">1.7 Modern C++ </a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_black.png" alt="images/cherry_black.png" height="22" width="22"/><a href="C++--bak.html">1.8 bak</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="go.html">2 go</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="go--nsq-notes.html">2.1 nsq-notes</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="go--go_tips.html">2.2 go_tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Q&A.html">3 Q&A</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="kernel.html">4 kernel</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="ffmpeg.html">5 ffmpeg</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="ffmpeg--ffmpeg SDK.html">5.1 ffmpeg SDK</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="ffmpeg--ffmpeg.html">5.2 ffmpeg</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="python.html">6 python</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="python--tips.html">6.1 tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_green.png" alt="images/cherry_green.png" height="22" width="22"/><a href="python--collections.html">6.2 collections</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="python--oneline.html">6.3 oneline</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Lua.html">7 Lua</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Lua--tips.html">7.1 tips</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Linux.html">8 Linux</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--shell.html">8.1 shell</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--collections.html">8.2 collections</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--screen.html">8.3 screen</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--core文件设置.html">8.4 core文件设置</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Linux--Linux 常用.html">8.5 Linux 常用</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_orange.png" alt="images/cherry_orange.png" height="22" width="22"/><a href="Linux--Linux 常用--screen.html">8.5.1 screen</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_orange.png" alt="images/cherry_orange.png" height="22" width="22"/><a href="Linux--Linux 常用--core文件设置.html">8.5.2 core文件设置</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_purple.png" alt="images/cherry_purple.png" height="22" width="22"/><a href="Linux--sed.html">8.6 sed</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="gdb.html">9 gdb</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="tools.html">10 tools</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="vim.html">11 vim</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="vim--vim常用 .html">11.1 vim常用 </a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="work.html">12 work</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="work--work 常用.html">12.1 work 常用</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="work--work.html">12.2 work</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Myself.html">13 Myself</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--TOREAD.html">13.1 TOREAD</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--music.html">13.2 music</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--todo.html">13.3 todo</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--work.html">13.4 work</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="Myself--HZ.html">13.5 HZ</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="opencv.html">14 opencv</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="opencv--CvArr、Mat、CvMat、IplImage、BYTE转换  .html">14.1 CvArr、Mat、CvMat、IplImage、BYTE转换  </a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="opencv--resize.html">14.2 resize</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="work.html">15 work</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="work--TODO.html">15.1 TODO</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="work--OCR.html">15.2 OCR</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_blue.png" alt="images/cherry_blue.png" height="22" width="22"/><a href="work--todo.html">15.3 todo</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src="images/cherry_gray.png" alt="images/cherry_gray.png" height="22" width="22"/><a href="work--sql.html">15.4 sql</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="CNTV.html">16 CNTV</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="Mysql.html">17 Mysql</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="git.html">18 git</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="others.html">19 others</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_purple.png" alt="images/cherry_purple.png" height="22" width="22"/><a href="gnuplot.html">20 gnuplot</a></td></tr><tr><td>&nbsp;&nbsp;&nbsp;<img src="images/cherry_red.png" alt="images/cherry_red.png" height="22" width="22"/><a href="todo.html">21 todo</a></td></tr></table><td valign="top" align=cons.TAG_PROP_LEFT width=80%><span style="font-family: 文泉驿微米黑; font-size:12pt">ffmpeg -i tt.mp4 -vn -strict -2 audio.mp4<br><br>Hi, all:<br><a href="http://122.192.67.86:8088/ts100">http://122.192.67.86:8088/ts100</a><br>1. ffmpeg snapshot，一秒二次<br><br>        ffmpeg -y -i test.flv -q:v 1 -r 2 -ss 10 -to 50 s%05d.jpg<br>ffmpeg -pix_fmt uyvy422 -s 720x576 -r 25 -i all.yuv -b 20480k -f s16le -ar 48000 -ac 2 -i all.pcm -vcodec libx264 $d<br><br>ffmpeg -pix_fmt uyvy422 -s 720x480 -r 25 -i all.yuv -b 20480k -f s16le -ar 48000 -ac 2 -i all.pcm -vcodec libx264 $d<br><br><br><br>ffmpeg -pix_fmt uyvy422 -s 720x480 -r 29.97 -i 1388659600059.yuv -b 20480k -vcodec libx264 t.avi<br><br><br>前20 s为空白<br> 1. 提取audio <br> ffmpeg -y -i test.mpg -vn a.mpg<br> 1. 提取video<br> ffmpeg -y -i test.mpg -an v.mpg<br>3.<br>3.1 生成 空白音频<br>ffmpeg -y -i /dev/zero -ar 44100 -ac 2 empty.mpg<br>注：这个过程是很快的， 只要大于20s了就可以停了。 44100, 2分别是a.mpg的bit rate, channels, 可以通过mediainfo a.mpg查看<br>3.2 取20s的空白音频 <br>ffmpeg -y -i empty.mpg -ss 0 -t 20  -codec copy e.mpg<br><br><br>4. concat e.mpg and a.mpg <br> ffmpeg -y -f concat  -i audio.merg -codec copy a2.mpg<br><br>audio.merg is a file like :​<br>li_yun@ubuntu:~/24$ <br>cat audio.merg <br>file e.mpg<br>file a2.mpg<br>5. merge audio and video file :<br>6. ffmpeg -i a2.mpg -i v.mpg -codec copy l.mpg <br>l.mpg is file U want, first 20 seconds is silent!<br><br><br><br><br>凤凰卫视资讯台<br> mms://112.230.192.196/zb12    凤凰资讯台高速高清<br>辽宁卫视<br>mms://112.230.192.196/zb17<br>厦门卫视<br>mms://mediasrv2.iptv.xmg.com.cn/tvhaixia <br>厦门影视<br>mms://mediasrv2.iptv.xmg.com.cn/tvyingshi<br>北京卫视<br>mms://112.230.192.196/zb11<br>CCTV5高清高速<br>mms://112.230.192.196/zb10<br> 好消息一台 <br>mms://live.jdjys.net/tv1 <br>好消息二台 强烈推荐<br>mms://live.jdjys.net/tv2 <br>天空新闻台 强烈推荐<br> mms://live1.wm.skynews.servecast.net/skynews_wmlz_live300k <br><br><br>使用DarwinStreamingServer搭建网络流：<br>首先下载源文件，http://dss.macosforge.org/选previous-releases，选Linux installer(v5.5.5)下面的<a href="http://dss.macosforge.org/downloads/DarwinStreamingSrvr5.5.5-Linux.tar.gz">Streaming  Server。</a><br> 下载的是个压缩文件，解压出文件夹，夹里有个Install文件，在命令行下先chmod +xInstall，然后执行./Install,很快安装完成，提示输入用户名和密码，这个随便写啦～<br> 之后在浏览器地址栏里输入http://127.0.0.1:1220,然后要求输入用户名，密码，和上面设置好的一样，然后有 SetupAssistant MP3 broadcast  Password,我仍然采用同样的密码，下一步ssl据说可以不用管，直接下一步添加媒体文件目录，/usr/local/movies，下一步设端口 没有动，直接finish。<br> 搭好了，可以用电影播放器来播放流媒体文件，比如<br> <br>rtsp://127.0.0.1/sample_100kbit.mp4 ，顺利播放～<br><br>启动 Darwin Streaming Server <br>sudo /usr/local/sbin/DarwinStreamingServer启动 Web 管理介面 (tcp port 1220)<br>sudo /usr/local/sbin/streamingadminserver.pl<br>PS：以上在安装好的时候会自动启动。<br><br>1. ffmpeg convert aac to mp3<br><br><br>/opt/ffmpeg/ffmpeg -y -rtmp_swfurl <a href="http://www.ustvnow.com/player/flowplayer.commercial-3.2.15.swf?sid=DUCMEKOG679DD4E32B47AF6CF70A425282ACFE73839">http://www.ustvnow.com/player/flowplayer.commercial-3.2.15.swf?sid=DUCMEKOG679DD4E32B47AF6CF70A425282ACFE73839</a> -i rtmp://lv9.ustvnow.com/dvrtest/ERR22WHP0USTVNOW2 -acodec copy -vcodec copy -map 0:v -map 0:a -bsf:v h264_mp4toannexb -f segment -segment_format mpegts -segment_time 1800 /opt/work/recorder/var/work/cbs/%d.ts<br><br><br><br><br><br><br><span style="font-size:x-large;">x264 – Recommended General Options</span><br>For  all rate control methods you will probably want libx264 to select the  number of threads to use to maximise its performance on your CPU(s):<br>-threads 0<br>./configure --enable-static --enabled-shared<br><br><br><span style="font-size:x-large;">Two-Pass Example</span><br>So if you wanted to encode using two-pass VBR, the command line would be something like:<br>ffmpeg -i INPUT -an -pass 1 -vcodec libx264 -vpre slow_firstpass -b BIT_RATE -bt BIT_RATE -threads 0 OUTPUT.mp4<br>Note: We don’t encode the audio in the first pass because we will not be using the data that was output.<br>ffmpeg -i INPUT -acodec libfaac -ab 128k -pass 2 -vcodec libx264 -vpre slow -b BIT_RATE -bt BIT_RATE -threads 0 OUTPUT.mp4<br><br><span style="font-size:x-large;">Single-Pass Constant Rate Factor (CRF) Example</span><br>Or for a single pass CRF encode:<br>ffmpeg -i INFILE -acodec libfaac -ab 96k -vcodec libx264 -vpre slow -crf 22 -threads 0 OUTPUT.mp4<br><br><br>test:<br>ffmpeg -y -i 1900.mp4  -vcodec h264  -pass 1 -refs 1 -g 2 -bf 0  t.mp4 | cpu 310% real	2m18.687s|user	7m18.128s|sys	0m4.560s<br>time ffmpeg -y -i 0230.mp4 -vcodec h264 -pass 1 -refs 1 -bf 1 -g 3   t.mp4|cpu 310% |real	2m21.721s|user	7m25.224s|sys	0m4.952s<br>time ffmpeg -y -i 0230.mp4 -vcodec h264 -pass 1 -refs 1 -bf 0 -g 5   t.mp4|cpu 330% |real	2m21.439s|user	6m20.300s|<br>time ffmpeg -y -i 0230.mp4 -vcodec h264 -pass 1 -refs 1 -bf 0 -g 75 -keyint_min 25 -coder 0 -me_method hex t.mp4|cpu 250~310%|real	2m9.074s|user	6m22.896s|sys	0m5.584s|<br><br><br>-vcodec libx264 -refs 1 -g 75 -bf 0 |CPU 100%~150%<br>-vcodec libx264 -refs 1 -g 5 -bf 0 |CPU 90%~120%<br><br><br>个人建议用MP3.0，帧率25，参考帧1, ONEPASS，B帧2，关键帧间隔2，码率CBR并注意大小<br>给个ffmpeg例子：<br><br> ffmpeg -i input.mp4 -vcodec h264 -pass 1 -s 720x576 -b 1500k -minrate 1500k -maxrate 1500k -refs 1 -bf 2 -g 2 -acodec mp2 -ar 48k -b:a 128k -vbsf h264_mp4toannexb  out.mp4<br> <br> ./ffmpeg -threads 4 -s 352x240 -i all.yuv -vcodec libx264  -flags +loop -cmp +chroma -deblockalpha 0 -deblockbeta 0 -crf 24 -bt 256k -refs 1 -coder 0  -me_range 16 -subq 5 -partitions +parti4x4+parti8x8+partp8x8 -g 250 -keyint_min 25 -level 30 -qmin 10 -qmax 51 -trellis 2 -sc_threshold 40 -i_qfactor 0.71  -ab 128k -ar 48000 -ac 2 all.h264<br><br><br>参考文章：Video Codecs Analysis and Tuning ，文档下载地址：http://www.yuvsoft.com/pdf/x264_parameters_comparison.pdf<br> 文章中详细比较了48种不同x264参数组合，比较得到如下6类最优的x264编译参数，我将文章中的x264参数转化为ffmpge命令参数如下：<br>1）fastest preset<br> ffmpeg -i NFSCAR_x360_trackDrift_HD720P.mov -f mp4 -vcodec libx264  -me_method dia -directpred 1 -me_range 16 -subq 1 -b_qfactor 1.5 -bf 1  -acodec libfaac sample_fastest.mp4<br>2）fast preset<br> ffmpeg -i NFSCAR_x360_trackDrift_HD720P.mov -f mp4 -vcodec libx264 -subq 1 -acodec libfaac sample_fast.mp4<br>3）tradeoff preset<br> ffmpeg -i NFSCAR_x360_trackDrift_HD720P.mov -f mp4 -vcodec libx264 -subq 3 -acodec libfaac sample_tradeoff.mp4<br>4）good preset<br> ffmpeg -i NFSCAR_x360_trackDrift_HD720P.mov -f mp4 -vcodec libx264 -bf 3  -bframebias 5 -flags2 +dct8x8+wpred+bpyramid -trellis 1 -acodec libfaac  sample_good.mp4<br>5）best preset<br> ffmpeg -i NFSCAR_x360_trackDrift_HD720P.mov -f mp4 -vcodec libx264 -bf 4  -flags2 +dct8x8+wpred+bpyramid -trellis 1 -refs 10 -directpred 3  -me_method umh -subq 7 -acodec libfaac sample_best.mp4<br>6）extra quality preset<br> ffmpeg -i NFSCAR_x360_trackDrift_HD720P.mov -f mp4 -vcodec libx264 -bf 4  -flags2 +dct8x8+wpred+bpyramid -refs 8 -directpred 3 -me_method umh  -subq 7 -pass 1 -acodec libfaac &gt; dev&amp;null<br>ffmpeg -i  NFSCAR_x360_trackDrift_HD720P.mov -f mp4 -vcodec libx264 -bf 4 -flags2  +dct8x8+wpred+bpyramid -refs 8 -directpred 3 -me_method umh -subq 7  -pass 2 -acodec libfaac sample_extra.mp4<br>下面表格显示在默认参数情况下编码速度以及平均码率相对百分比：<br> Preset Name Speed, % Average bitrate, %<br> Fastest            47                 114<br> Fast                 56                 109<br> Tradeoff          70                  102<br> Good              121                   89<br> Best                369                   77<br> Extra Quality   710                   72<br>我测试分辨率1280 x  720，20帧的赛车视频，视频原始大小100442K，视频使用Sorenson Video 3编码，音频使用 MPEG-1 Layer  3编码，使用上诉5种参数分别编码得到53897K、59303K、60251K、63670K、55405K、55405K。我个人比较倾向于best  preset参数。<br>在使用使用如下best参数编码的h264视频，播放时最高CPU利用率不超过4%，但效果明显比FLV效果高<br>ffmpeg -i  NFSCAR_x360_trackDrift_HD720P.mov -f mp4 -vcodec libx264 -bf 4 -flags2  +bpyramid+wpred+8x8dct -trellis 1 -refs 10 -directpred 3 -me_method umh  -subq 7 -s 352*288 -r 7.5 -aspect 16:9 -acodec libfaac -ab 32k  sample_best_352_288_7.mp4<br> <br> ffmpeg -i NFSCAR_x360_trackDrift_HD720P.mov -f flv -vcodec flv -acodec libmp3lame sample_352_288.flv<br> <br> 视频大小分别为4212K（x264）、4816K(Flash/Sorenson)<br><br><br>FFmpeg option x264 option <br>-g &lt;frames&gt; –keyint <br>-b &lt;bits per second&gt; –bitrate <br>-bufsize &lt;bits&gt; –vbv-bufsize <br>-maxrate &lt;bits&gt; –vbv-maxrate <br>-pass &lt;1,2,3&gt; –pass <br>-crf &lt;float&gt; –crf <br>-cqp &lt;int&gt; –qp <br>-bf &lt;int&gt; –bframes <br>-coder &lt;0,1&gt; –no-cabac <br>-bframebias &lt;int&gt; –b-bias <br>-keyint_min &lt;int&gt; –min-keyint <br>-sc_threshold &lt;int&gt; –scenecut <br>-deblockalpha &lt;int&gt;-deblockbeta &lt;int&gt; –deblock <br>-qmin &lt;int&gt; –qpmin <br>-qmax &lt;int&gt; –qpmax <br>-qdiff &lt;int&gt; –qpstep <br>-qcomp &lt;float&gt; –qcomp <br>-qblur &lt;float&gt; –qblur <br>-complexityblur &lt;float&gt; –cplxblur <br>-refs &lt;int&gt; –ref <br>-directpred &lt;int&gt; –direct <br>-me_method &lt;epzs,hex,umh,full&gt; –me <br>-me_range &lt;int&gt; –merange <br>-subq &lt;int&gt; –subme <br>-bidir_refine &lt;0,1&gt; –bime <br>-trellis &lt;0,1,2&gt; –trellis <br>-nr &lt;int&gt; –nr <br>-level &lt;int&gt; –level <br>-bt &lt;bits&gt; –ratetol = -bt / -b <br>-rc_init_occupancy &lt;bits&gt; –vbv-init = -rc_init_occupancy / -bufsize <br>-i_qfactor &lt;float&gt; –ipratio = 1 / -i_qfactor <br>-b_qfactor &lt;float&gt; –pbratio <br>-chromaoffset &lt;int&gt; –chroma-qp-offset <br>-rc_eq &lt;string&gt; –rc_eq <br>-threads &lt;int&gt; –threads <br>-cmp &lt;-chroma/+chroma&gt; –no-chroma-me <br>-partitions –partitions <br>+parti8×8 i8×8 <br>+parti4×4 i4×4 <br>+partp8×8 p8×8 <br>+partp4×4 p4×4 <br>+partb8×8 b8×8 <br>-flags <br>-loop/+loop –no-deblock/–deblock <br>-psnr/+psnr –no-psnr/nothing <br>-flags2 <br>+bpyramid –b-pyramid <br>+wpred –weightb <br>+brdo –b-rdo 我这里的ffmpeg已经不能用这个了 <br>+mixed_refs –mixed-refs <br>+dct8×8 –8×8dct <br>-fastpskip/+fastpskip –no-fast-pskip <br>+aud –aud <br><br>/opt/ffmpeg/ffmpeg -y -rtmp_swfurl <a href="http://www.ustvnow.com/player/flowplayer.commercial-3.2.15.swf?sid=WRAFDIGP67956133A6391A37CE3C3EFEB14BC4F589E">http://www.ustvnow.com/player/flowplayer.commercial-3.2.15.swf?sid=WRAFDIGP67956133A6391A37CE3C3EFEB14BC4F589E</a> -i rtmp://lv9.ustvnow.com/dvrtest/8AB2CWGALUSTVNOW2 -acodec copy -vcodec copy -map 0:v -map 0:a -bsf:v h264_mp4toannexb -f segment -segment_format mpegts -segment_time 1800 /opt/work/recorder/var/work/nbc/%d.ts<br><br>ffmpeg 直接录制v4l2<br>ffmpeg  -f alsa -i hw:6 -f video4linux2 -s 720x480 -r 25 -i /dev/video6 out.avi<br></span></td></tr></table></body></html>